<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Learnify - PanTool Enhancement Implementation Guide | Alex Sun Blog</title><meta name="author" content="Alex Sun,me@xsun.work"><meta name="copyright" content="Alex Sun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Learnify - PanTool Enhancement Implementation GuideOverviewThis document provides a detailed record of the enhancement process for PanTool, upgrading it from a simple panning tool to a comprehensive t">
<meta property="og:type" content="article">
<meta property="og:title" content="Learnify - PanTool Enhancement Implementation Guide">
<meta property="og:url" content="http://xsun.work/posts/aca9ee12/">
<meta property="og:site_name" content="Alex Sun Blog">
<meta property="og:description" content="Learnify - PanTool Enhancement Implementation GuideOverviewThis document provides a detailed record of the enhancement process for PanTool, upgrading it from a simple panning tool to a comprehensive t">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png">
<meta property="article:published_time" content="2025-07-09T09:57:14.589Z">
<meta property="article:modified_time" content="2025-07-09T10:13:24.042Z">
<meta property="article:author" content="Alex Sun">
<meta property="article:tag" content="AI generated">
<meta property="article:tag" content="AI summary">
<meta property="article:tag" content="Learnify">
<meta property="article:tag" content="Claude Code">
<meta property="article:tag" content="Claude-4-Opus">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Learnify - PanTool Enhancement Implementation Guide",
  "url": "http://xsun.work/posts/aca9ee12/",
  "image": "https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png",
  "datePublished": "2025-07-09T09:57:14.589Z",
  "dateModified": "2025-07-09T10:13:24.042Z",
  "author": [
    {
      "@type": "Person",
      "name": "Alex Sun",
      "url": "http://xsun.work"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xsun.work/posts/aca9ee12/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//static.cloudflareinsights.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/img/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/img/pwa/logo.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/logo144.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/logo144.png"/><link rel="mask-icon" href="/img/pwa/logo.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 17
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;03dcf6db28f54759abb2aa84ff0901e5&quot;}"></script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: Alex Sun","link":"Link: ","source":"Source: Alex Sun Blog","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#D2CFCA","bgDark":"#2d3035","position":"top-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Learnify - PanTool Enhancement Implementation Guide',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link href='https://fonts.googleapis.com/css?family=Bad Script' rel='stylesheet'><link rel="stylesheet" type="text/css" href="/css/self.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Alex Sun Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-paperclip"></i><span> Page</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-laptop-code"></i><span> Dev</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/AI/"><i class="fa-fw fas fa-robot"></i><span> AI</span></a></li><li><a class="site-page child" href="/categories/Web/"><i class="fa-fw fab fa-html5"></i><span> Web</span></a></li><li><a class="site-page child" href="/categories/Server/"><i class="fa-fw fas fa-server"></i><span> Backend</span></a></li><li><a class="site-page child" href="/categories/Cloud/"><i class="fa-fw fas fa-cloud"></i><span> Cloud</span></a></li><li><a class="site-page child" href="/categories/DevOps/"><i class="fa-fw fab fa-docker"></i><span> DevOps</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-code"></i><span> All</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-horse-head"></i><span> Portfolios</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/portfolios/light-plm"><i class="fa-fw fas fa-bar-chart"></i><span> Light PLM</span></a></li><li><a class="site-page child" href="/portfolios/light-viewer"><i class="fa-fw fas fa-low-vision"></i><span> Light Viewer</span></a></li><li><a class="site-page child" href="/portfolios/light-gpt"><i class="fa-fw fas fa-search"></i><span> Light GPT</span></a></li><li><a class="site-page child" href="/portfolios/xsun-ui"><i class="fa-fw fa fa-paintbrush"></i><span> Xsun UI</span></a></li><li><a class="site-page child" href="/portfolios/ir-calculator"><i class="fa-fw fas fa-calculator"></i><span> Real Interest Calculator</span></a></li><li><a class="site-page child" href="/portfolios/iframe-keep-alive"><i class="fa-fw fas fa-code"></i><span> iframe keep-alive Demo</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about-me/"><i class="fa-fw fas fa-portrait"></i><span> Resume</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Language</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://xsun.work/zh-CN"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"></a><a class="nav-page-title" href="/"><span class="site-name">Learnify - PanTool Enhancement Implementation Guide</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-paperclip"></i><span> Page</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-laptop-code"></i><span> Dev</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/AI/"><i class="fa-fw fas fa-robot"></i><span> AI</span></a></li><li><a class="site-page child" href="/categories/Web/"><i class="fa-fw fab fa-html5"></i><span> Web</span></a></li><li><a class="site-page child" href="/categories/Server/"><i class="fa-fw fas fa-server"></i><span> Backend</span></a></li><li><a class="site-page child" href="/categories/Cloud/"><i class="fa-fw fas fa-cloud"></i><span> Cloud</span></a></li><li><a class="site-page child" href="/categories/DevOps/"><i class="fa-fw fab fa-docker"></i><span> DevOps</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-code"></i><span> All</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-horse-head"></i><span> Portfolios</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/portfolios/light-plm"><i class="fa-fw fas fa-bar-chart"></i><span> Light PLM</span></a></li><li><a class="site-page child" href="/portfolios/light-viewer"><i class="fa-fw fas fa-low-vision"></i><span> Light Viewer</span></a></li><li><a class="site-page child" href="/portfolios/light-gpt"><i class="fa-fw fas fa-search"></i><span> Light GPT</span></a></li><li><a class="site-page child" href="/portfolios/xsun-ui"><i class="fa-fw fa fa-paintbrush"></i><span> Xsun UI</span></a></li><li><a class="site-page child" href="/portfolios/ir-calculator"><i class="fa-fw fas fa-calculator"></i><span> Real Interest Calculator</span></a></li><li><a class="site-page child" href="/portfolios/iframe-keep-alive"><i class="fa-fw fas fa-code"></i><span> iframe keep-alive Demo</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about-me/"><i class="fa-fw fas fa-portrait"></i><span> Resume</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Language</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://xsun.work/zh-CN"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Learnify - PanTool Enhancement Implementation Guide</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-07-09T09:57:14.589Z" title="Created 2025-07-09 17:57:14">2025-07-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-07-09T10:13:24.042Z" title="Updated 2025-07-09 18:13:24">2025-07-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">1.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>10mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-07-09 18:13:24&quot;}" hidden></div><h1 id="Learnify-PanTool-Enhancement-Implementation-Guide"><a href="#Learnify-PanTool-Enhancement-Implementation-Guide" class="headerlink" title="Learnify - PanTool Enhancement Implementation Guide"></a>Learnify - PanTool Enhancement Implementation Guide</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>This document provides a detailed record of the enhancement process for <code>PanTool</code>, upgrading it from a simple panning tool to a comprehensive tool that supports complete mind map interactions. This enhancement maintains the original panning functionality while adding complete interaction support including hover, click, double-click, and more.</p>
<h2 id="Original-PanTool-Analysis"><a href="#Original-PanTool-Analysis" class="headerlink" title="Original PanTool Analysis"></a>Original PanTool Analysis</h2><h3 id="Functional-Limitations"><a href="#Functional-Limitations" class="headerlink" title="Functional Limitations"></a>Functional Limitations</h3><p>The original <code>PanTool</code> located at <code>blocksuite/affine/gfx/pointer/src/tools/pan-tool.ts</code> only implemented basic panning functionality:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PanTool</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseTool</span>&lt;<span class="title class_">PanToolOption</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">override</span> toolName = <span class="string">&#x27;pan&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_lastPoint</span>: [<span class="built_in">number</span>, <span class="built_in">number</span>] | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">readonly</span> panning$ = <span class="keyword">new</span> <span class="title class_">Signal</span>&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Only drag-related methods</span></span><br><span class="line">  <span class="keyword">override</span> <span class="title function_">dragStart</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_lastPoint</span> = [e.<span class="property">x</span>, e.<span class="property">y</span>];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">panning$</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="title function_">dragMove</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_lastPoint</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; viewport &#125; = <span class="variable language_">this</span>.<span class="property">gfx</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; zoom &#125; = viewport;</span><br><span class="line">    <span class="keyword">const</span> [lastX, lastY] = <span class="variable language_">this</span>.<span class="property">_lastPoint</span>;</span><br><span class="line">    <span class="keyword">const</span> deltaX = lastX - e.<span class="property">x</span>;</span><br><span class="line">    <span class="keyword">const</span> deltaY = lastY - e.<span class="property">y</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_lastPoint</span> = [e.<span class="property">x</span>, e.<span class="property">y</span>];</span><br><span class="line">    viewport.<span class="title function_">applyDeltaCenter</span>(deltaX / zoom, deltaY / zoom);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="title function_">dragEnd</span>(<span class="attr">_</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_lastPoint</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">panning$</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Missing key methods:</span></span><br><span class="line">  <span class="comment">// - pointerMove (hover functionality)</span></span><br><span class="line">  <span class="comment">// - click (click interaction)</span></span><br><span class="line">  <span class="comment">// - pointerDown/pointerUp</span></span><br><span class="line">  <span class="comment">// - doubleClick</span></span><br><span class="line">  <span class="comment">// - interactivity system integration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Problem-Analysis"><a href="#Problem-Analysis" class="headerlink" title="Problem Analysis"></a>Problem Analysis</h3><ol>
<li><strong>Incomplete event handling</strong>: Only processes drag events, ignoring other interaction events</li>
<li><strong>Missing interactivity integration</strong>: No integration with BlockSuite&#39;s interaction system</li>
<li><strong>Single functionality</strong>: Can only pan, unable to perform other operations</li>
</ol>
<h2 id="Enhancement-Design-Goals"><a href="#Enhancement-Design-Goals" class="headerlink" title="Enhancement Design Goals"></a>Enhancement Design Goals</h2><h3 id="Functional-Goals"><a href="#Functional-Goals" class="headerlink" title="Functional Goals"></a>Functional Goals</h3><ol>
<li><strong>Maintain original functionality</strong>: Panning functionality remains completely unaffected</li>
<li><strong>Add interaction support</strong>: Complete interactions including hover, click, double-click, etc.</li>
<li><strong>Mind map compatibility</strong>: Especially mind map expand&#x2F;collapse functionality</li>
<li><strong>Performance optimization</strong>: Avoid unnecessary event processing overhead</li>
</ol>
<h3 id="Design-Principles"><a href="#Design-Principles" class="headerlink" title="Design Principles"></a>Design Principles</h3><ol>
<li><strong>Backward compatibility</strong>: Do not break existing panning logic</li>
<li><strong>Event dispatch priority</strong>: Prioritize dispatching to interactivity system, then handle tool-specific logic</li>
<li><strong>Code reuse</strong>: Reuse mature patterns from DefaultTool</li>
<li><strong>Clear responsibility separation</strong>: Separate panning logic vs interaction logic</li>
</ol>
<h2 id="Implementation-Steps"><a href="#Implementation-Steps" class="headerlink" title="Implementation Steps"></a>Implementation Steps</h2><h3 id="1-Import-Dependencies"><a href="#1-Import-Dependencies" class="headerlink" title="1. Import Dependencies"></a>1. Import Dependencies</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Original imports</span></span><br><span class="line"><span class="keyword">import</span> &#123; on &#125; <span class="keyword">from</span> <span class="string">&#x27;@blocksuite/affine-shared/utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">PointerEventState</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@blocksuite/std&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BaseTool</span>, <span class="title class_">MouseButton</span>, <span class="keyword">type</span> <span class="title class_">ToolOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@blocksuite/std/gfx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Signal</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@preact/signals-core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New imports</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">BaseTool</span>,</span><br><span class="line">  <span class="title class_">InteractivityIdentifier</span>, <span class="comment">// New - interactivity system identifier</span></span><br><span class="line">  <span class="title class_">MouseButton</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">ToolOptions</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@blocksuite/std/gfx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signal &#125; <span class="keyword">from</span> <span class="string">&#x27;@preact/signals-core&#x27;</span>; <span class="comment">// Updated - using new signal API</span></span><br></pre></td></tr></table></figure>

<p><strong>Change Notes</strong>:</p>
<ul>
<li>Added <code>InteractivityIdentifier</code> for accessing the interaction system</li>
<li>Changed <code>Signal</code> to <code>signal</code> to use the new API</li>
<li>Organized import order to comply with linting rules</li>
</ul>
<h3 id="2-Add-Interactivity-System-Support"><a href="#2-Add-Interactivity-System-Support" class="headerlink" title="2. Add Interactivity System Support"></a>2. Add Interactivity System Support</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PanTool</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseTool</span>&lt;<span class="title class_">PanToolOption</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// ... existing properties ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// New - interactivity system accessor</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">interactivity</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">std</span>.<span class="title function_">getOptional</span>(<span class="title class_">InteractivityIdentifier</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Key Functions</strong>:</p>
<ul>
<li>Provides access to BlockSuite&#39;s interaction system</li>
<li>Enables the tool to dispatch events to the Extension system</li>
<li>Reuses existing interaction logic without reimplementation</li>
</ul>
<h3 id="3-Enhanced-Drag-Event-Handling"><a href="#3-Enhanced-Drag-Event-Handling" class="headerlink" title="3. Enhanced Drag Event Handling"></a>3. Enhanced Drag Event Handling</h3><h4 id="Original-Implementation"><a href="#Original-Implementation" class="headerlink" title="Original Implementation"></a>Original Implementation</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">dragEnd</span>(<span class="attr">_</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_lastPoint</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">panning$</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Enhanced-Implementation"><a href="#Enhanced-Implementation" class="headerlink" title="Enhanced Implementation"></a>Enhanced Implementation</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">dragEnd</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Prioritize dispatching to interactivity system</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;dragend&#x27;</span>, e);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Then handle panning-related logic</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_lastPoint</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">panning$</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Design Considerations</strong>:</p>
<ul>
<li><strong>Event dispatch priority</strong>: Let interactivity system handle first, as other Extensions might need this event</li>
<li><strong>Maintain original logic</strong>: Panning state management remains unchanged</li>
<li><strong>Parameter usage</strong>: Correctly use event parameters to avoid linter warnings</li>
</ul>
<h3 id="4-Add-Complete-Interaction-Methods"><a href="#4-Add-Complete-Interaction-Methods" class="headerlink" title="4. Add Complete Interaction Methods"></a>4. Add Complete Interaction Methods</h3><h4 id="click-Click-Interaction"><a href="#click-Click-Interaction" class="headerlink" title="click - Click Interaction"></a>click - Click Interaction</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">click</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Dispatch click events to interactivity system for mind map expand/collapse functionality</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;click&#x27;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Functionality</strong>:</p>
<ul>
<li>Mind map node expand&#x2F;collapse</li>
<li>Button click responses</li>
<li>Selection operations</li>
</ul>
<h4 id="pointerMove-Hover-Functionality"><a href="#pointerMove-Hover-Functionality" class="headerlink" title="pointerMove - Hover Functionality"></a>pointerMove - Hover Functionality</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">pointerMove</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Dispatch pointer move events to interactivity system for hover functionality</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;pointermove&#x27;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Functionality</strong>:</p>
<ul>
<li>Element hover highlighting</li>
<li>Collapse button show&#x2F;hide</li>
<li>Cursor style changes</li>
<li>Tooltip display</li>
</ul>
<h4 id="pointerDown-pointerUp-Complete-Mouse-Lifecycle"><a href="#pointerDown-pointerUp-Complete-Mouse-Lifecycle" class="headerlink" title="pointerDown&#x2F;pointerUp - Complete Mouse Lifecycle"></a>pointerDown&#x2F;pointerUp - Complete Mouse Lifecycle</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">pointerDown</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Dispatch pointerdown events to interactivity system</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;pointerdown&#x27;</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="title function_">pointerUp</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Dispatch pointerup events to interactivity system</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;pointerup&#x27;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Functionality</strong>:</p>
<ul>
<li>Press&#x2F;release state management</li>
<li>Drag preparation and ending</li>
<li>Complex interaction state machines</li>
</ul>
<h4 id="doubleClick-Double-Click-Operations"><a href="#doubleClick-Double-Click-Operations" class="headerlink" title="doubleClick - Double-Click Operations"></a>doubleClick - Double-Click Operations</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">doubleClick</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Dispatch double-click events to interactivity system</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;dblclick&#x27;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Functionality</strong>:</p>
<ul>
<li>Quick editing</li>
<li>Special operation triggers</li>
<li>Context-related double-click behaviors</li>
</ul>
<h3 id="5-Signal-System-Update"><a href="#5-Signal-System-Update" class="headerlink" title="5. Signal System Update"></a>5. Signal System Update</h3><h4 id="Original-Implementation-1"><a href="#Original-Implementation-1" class="headerlink" title="Original Implementation"></a>Original Implementation</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">readonly</span> panning$ = <span class="keyword">new</span> <span class="title class_">Signal</span>&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Updated-Implementation"><a href="#Updated-Implementation" class="headerlink" title="Updated Implementation"></a>Updated Implementation</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">readonly</span> panning$ = <span class="title function_">signal</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Reasons for Change</strong>:</p>
<ul>
<li>Use the new signal API</li>
<li>More concise syntax</li>
<li>Better type inference</li>
</ul>
<h2 id="How-It-Works"><a href="#How-It-Works" class="headerlink" title="How It Works"></a>How It Works</h2><h3 id="Event-Handling-Flow"><a href="#Event-Handling-Flow" class="headerlink" title="Event Handling Flow"></a>Event Handling Flow</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant User as User Operation</span><br><span class="line">    participant Browser as Browser</span><br><span class="line">    participant TC as ToolController</span><br><span class="line">    participant PT as PanTool</span><br><span class="line">    participant IS as Interactivity System</span><br><span class="line">    participant MV as MindMapView</span><br><span class="line"></span><br><span class="line">    User-&gt;&gt;Browser: Mouse move</span><br><span class="line">    Browser-&gt;&gt;TC: pointermove event</span><br><span class="line">    TC-&gt;&gt;PT: pointerMove(e)</span><br><span class="line">    PT-&gt;&gt;IS: dispatchEvent(&#x27;pointermove&#x27;, e)</span><br><span class="line">    IS-&gt;&gt;MV: Handle hover logic</span><br><span class="line">    MV-&gt;&gt;Browser: Update visual feedback</span><br><span class="line"></span><br><span class="line">    User-&gt;&gt;Browser: Drag start</span><br><span class="line">    Browser-&gt;&gt;TC: dragstart event</span><br><span class="line">    TC-&gt;&gt;PT: dragStart(e)</span><br><span class="line">    PT-&gt;&gt;PT: Set _lastPoint, panning$=true</span><br><span class="line"></span><br><span class="line">    User-&gt;&gt;Browser: Drag move</span><br><span class="line">    Browser-&gt;&gt;TC: dragmove event</span><br><span class="line">    TC-&gt;&gt;PT: dragMove(e)</span><br><span class="line">    PT-&gt;&gt;PT: Calculate delta and pan view</span><br><span class="line"></span><br><span class="line">    User-&gt;&gt;Browser: Drag end</span><br><span class="line">    Browser-&gt;&gt;TC: dragend event</span><br><span class="line">    TC-&gt;&gt;PT: dragEnd(e)</span><br><span class="line">    PT-&gt;&gt;IS: dispatchEvent(&#x27;dragend&#x27;, e)</span><br><span class="line">    PT-&gt;&gt;PT: Clean state _lastPoint=null, panning$=false</span><br></pre></td></tr></table></figure>

<h3 id="Maintaining-Panning-Functionality"><a href="#Maintaining-Panning-Functionality" class="headerlink" title="Maintaining Panning Functionality"></a>Maintaining Panning Functionality</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">dragMove</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// Panning functionality completely maintains original logic</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_lastPoint</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; viewport &#125; = <span class="variable language_">this</span>.<span class="property">gfx</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; zoom &#125; = viewport;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [lastX, lastY] = <span class="variable language_">this</span>.<span class="property">_lastPoint</span>;</span><br><span class="line">  <span class="keyword">const</span> deltaX = lastX - e.<span class="property">x</span>;</span><br><span class="line">  <span class="keyword">const</span> deltaY = lastY - e.<span class="property">y</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_lastPoint</span> = [e.<span class="property">x</span>, e.<span class="property">y</span>];</span><br><span class="line"></span><br><span class="line">  viewport.<span class="title function_">applyDeltaCenter</span>(deltaX / zoom, deltaY / zoom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Reasons for Maintaining Unchanged</strong>:</p>
<ul>
<li>Panning logic is already mature</li>
<li>Performance optimization is good</li>
<li>User experience is consistent</li>
</ul>
<h3 id="Enhanced-Interaction-Functionality"><a href="#Enhanced-Interaction-Functionality" class="headerlink" title="Enhanced Interaction Functionality"></a>Enhanced Interaction Functionality</h3><p>Mind map interactions now work properly:</p>
<ol>
<li><strong>Hover effects</strong>: <code>pointerMove</code> → <code>interactivity</code> → <code>MindMapView</code> → Show collapse button</li>
<li><strong>Click expand</strong>: <code>click</code> → <code>interactivity</code> → Related Extension → Expand&#x2F;collapse node</li>
<li><strong>Cursor changes</strong>: Cursor becomes pointer on hover, returns to default on leave</li>
</ol>
<h2 id="Testing-and-Validation"><a href="#Testing-and-Validation" class="headerlink" title="Testing and Validation"></a>Testing and Validation</h2><h3 id="Functional-Testing"><a href="#Functional-Testing" class="headerlink" title="Functional Testing"></a>Functional Testing</h3><h4 id="1-Panning-Functionality-Test"><a href="#1-Panning-Functionality-Test" class="headerlink" title="1. Panning Functionality Test"></a>1. Panning Functionality Test</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Test drag panning</span></span><br><span class="line"><span class="keyword">const</span> startEvent = &#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">100</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> moveEvent = &#123; <span class="attr">x</span>: <span class="number">150</span>, <span class="attr">y</span>: <span class="number">120</span> &#125;;</span><br><span class="line"></span><br><span class="line">panTool.<span class="title function_">dragStart</span>(startEvent);</span><br><span class="line">panTool.<span class="title function_">dragMove</span>(moveEvent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify view actually panned</span></span><br><span class="line"><span class="title function_">assert</span>(viewport.<span class="property">centerX</span> !== originalCenterX);</span><br><span class="line"><span class="title function_">assert</span>(viewport.<span class="property">centerY</span> !== originalCenterY);</span><br></pre></td></tr></table></figure>

<h4 id="2-Interaction-Functionality-Test"><a href="#2-Interaction-Functionality-Test" class="headerlink" title="2. Interaction Functionality Test"></a>2. Interaction Functionality Test</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Test hover functionality</span></span><br><span class="line"><span class="keyword">const</span> hoverEvent = &#123; <span class="attr">x</span>: nodeX, <span class="attr">y</span>: nodeY &#125;;</span><br><span class="line">panTool.<span class="title function_">pointerMove</span>(hoverEvent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify collapse button display</span></span><br><span class="line"><span class="title function_">assert</span>(collapseButton.<span class="property">opacity</span> &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test click functionality</span></span><br><span class="line">panTool.<span class="title function_">click</span>(hoverEvent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify node state change</span></span><br><span class="line"><span class="title function_">assert</span>(node.<span class="property">collapsed</span> !== originalCollapsed);</span><br></pre></td></tr></table></figure>

<h3 id="Performance-Testing"><a href="#Performance-Testing" class="headerlink" title="Performance Testing"></a>Performance Testing</h3><h4 id="1-Event-Handling-Overhead"><a href="#1-Event-Handling-Overhead" class="headerlink" title="1. Event Handling Overhead"></a>1. Event Handling Overhead</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> startTime = performance.<span class="title function_">now</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  panTool.<span class="title function_">pointerMove</span>(&#123; <span class="attr">x</span>: i % <span class="number">100</span>, <span class="attr">y</span>: i % <span class="number">100</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> endTime = performance.<span class="title function_">now</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`1000 pointerMove events: <span class="subst">$&#123;endTime - startTime&#125;</span>ms`</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-Memory-Usage"><a href="#2-Memory-Usage" class="headerlink" title="2. Memory Usage"></a>2. Memory Usage</h4><ul>
<li>No significant memory overhead added</li>
<li>Reuses existing interactivity system</li>
<li>Event dispatch is lightweight</li>
</ul>
<h2 id="Compatibility-Considerations"><a href="#Compatibility-Considerations" class="headerlink" title="Compatibility Considerations"></a>Compatibility Considerations</h2><h3 id="Backward-Compatibility"><a href="#Backward-Compatibility" class="headerlink" title="Backward Compatibility"></a>Backward Compatibility</h3><ol>
<li><strong>API compatibility</strong>: All existing public methods and properties remain unchanged</li>
<li><strong>Behavior compatibility</strong>: Panning behavior is completely consistent</li>
<li><strong>Middle-click panning</strong>: Temporary panning functionality maintains original logic</li>
</ol>
<h3 id="Middle-Click-Panning-Functionality"><a href="#Middle-Click-Panning-Functionality" class="headerlink" title="Middle-Click Panning Functionality"></a>Middle-Click Panning Functionality</h3><p>The existing middle-click panning functionality in the <code>mounted()</code> method remains completely unchanged:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">mounted</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">addHook</span>(<span class="string">&#x27;pointerDown&#x27;</span>, <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> shouldPanWithMiddle = evt.<span class="property">raw</span>.<span class="property">button</span> === <span class="title class_">MouseButton</span>.<span class="property">MIDDLE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!shouldPanWithMiddle) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... middle-click panning logic remains unchanged ...</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Debugging-and-Monitoring"><a href="#Debugging-and-Monitoring" class="headerlink" title="Debugging and Monitoring"></a>Debugging and Monitoring</h2><h3 id="Event-Tracking"><a href="#Event-Tracking" class="headerlink" title="Event Tracking"></a>Event Tracking</h3><p>Debug code added during development:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">pointerMove</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;PanTool.pointerMove - dispatching to interactivity&#x27;</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;pointermove&#x27;</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="title function_">click</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;PanTool.click - dispatching to interactivity&#x27;</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;click&#x27;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>These logs help confirm events are properly dispatched.</p>
<h3 id="Performance-Monitoring"><a href="#Performance-Monitoring" class="headerlink" title="Performance Monitoring"></a>Performance Monitoring</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> _eventCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="title function_">pointerMove</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_eventCount</span>++;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_eventCount</span> % <span class="number">100</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`PanTool processed <span class="subst">$&#123;<span class="variable language_">this</span>._eventCount&#125;</span> pointer moves`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;pointermove&#x27;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Known-Issues-and-Solutions"><a href="#Known-Issues-and-Solutions" class="headerlink" title="Known Issues and Solutions"></a>Known Issues and Solutions</h2><h3 id="1-Linter-Errors"><a href="#1-Linter-Errors" class="headerlink" title="1. Linter Errors"></a>1. Linter Errors</h3><p><strong>Issue</strong>: Unused parameter warnings</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">dragEnd</span>(<span class="attr">_</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> <span class="comment">// &#x27;_&#x27; is defined but never used</span></span><br></pre></td></tr></table></figure>

<p><strong>Solution</strong>: Properly use parameters for event dispatch</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="title function_">dragEnd</span>(<span class="attr">e</span>: <span class="title class_">PointerEventState</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interactivity</span>?.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;dragend&#x27;</span>, e);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Import-Order"><a href="#2-Import-Order" class="headerlink" title="2. Import Order"></a>2. Import Order</h3><p><strong>Issue</strong>: ESLint import sorting warnings</p>
<p><strong>Solution</strong>: Organize imports in alphabetical order</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BaseTool</span>, <span class="title class_">InteractivityIdentifier</span>, <span class="title class_">MouseButton</span>, <span class="keyword">type</span> <span class="title class_">ToolOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@blocksuite/std/gfx&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-Signal-API-Update"><a href="#3-Signal-API-Update" class="headerlink" title="3. Signal API Update"></a>3. Signal API Update</h3><p><strong>Issue</strong>: Old Signal constructor</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">readonly</span> panning$ = <span class="keyword">new</span> <span class="title class_">Signal</span>&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>); <span class="comment">// Outdated API</span></span><br></pre></td></tr></table></figure>

<p><strong>Solution</strong>: Use new signal function</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">readonly</span> panning$ = <span class="title function_">signal</span>(<span class="literal">false</span>); <span class="comment">// Modern API</span></span><br></pre></td></tr></table></figure>

<h2 id="Best-Practices-Summary"><a href="#Best-Practices-Summary" class="headerlink" title="Best Practices Summary"></a>Best Practices Summary</h2><h3 id="Tool-Design-Principles"><a href="#Tool-Design-Principles" class="headerlink" title="Tool Design Principles"></a>Tool Design Principles</h3><ol>
<li><strong>Functional completeness</strong>: Tools should provide complete user interaction experience</li>
<li><strong>Event dispatch priority</strong>: Prioritize dispatching to interactivity system, then handle tool-specific logic</li>
<li><strong>Backward compatibility</strong>: Keep existing functionality unaffected</li>
<li><strong>Performance considerations</strong>: Avoid unnecessary calculations and DOM operations</li>
</ol>
<h3 id="Code-Organization"><a href="#Code-Organization" class="headerlink" title="Code Organization"></a>Code Organization</h3><ol>
<li><strong>Clear method separation</strong>: Panning logic vs interaction logic</li>
<li><strong>Consistent naming</strong>: Follow BlockSuite naming conventions</li>
<li><strong>Adequate comments</strong>: Explain the purpose and design considerations of each method</li>
</ol>
<h3 id="Testing-Strategy"><a href="#Testing-Strategy" class="headerlink" title="Testing Strategy"></a>Testing Strategy</h3><ol>
<li><strong>Functional testing</strong>: Ensure all functionality works properly</li>
<li><strong>Performance testing</strong>: Verify performance is not significantly affected</li>
<li><strong>Compatibility testing</strong>: Ensure backward compatibility</li>
<li><strong>User experience testing</strong>: Verify consistent interaction experience</li>
</ol>
<h2 id="File-Comparison"><a href="#File-Comparison" class="headerlink" title="File Comparison"></a>File Comparison</h2><h3 id="Before-vs-After-Modifications"><a href="#Before-vs-After-Modifications" class="headerlink" title="Before vs After Modifications"></a>Before vs After Modifications</h3><table>
<thead>
<tr>
<th>Functionality</th>
<th>Before</th>
<th>After</th>
</tr>
</thead>
<tbody><tr>
<td>Panning functionality</td>
<td>✅ Complete</td>
<td>✅ Unchanged</td>
</tr>
<tr>
<td>Hover effects</td>
<td>❌ None</td>
<td>✅ Full support</td>
</tr>
<tr>
<td>Click interaction</td>
<td>❌ None</td>
<td>✅ Full support</td>
</tr>
<tr>
<td>Double-click ops</td>
<td>❌ None</td>
<td>✅ Full support</td>
</tr>
<tr>
<td>Middle-click panning</td>
<td>✅ Complete</td>
<td>✅ Unchanged</td>
</tr>
<tr>
<td>Interactivity integration</td>
<td>❌ None</td>
<td>✅ Fully integrated</td>
</tr>
</tbody></table>
<h2 id="Related-Files"><a href="#Related-Files" class="headerlink" title="Related Files"></a>Related Files</h2><ul>
<li><code>blocksuite/affine/gfx/pointer/src/tools/pan-tool.ts</code> - Enhanced PanTool implementation</li>
<li><code>blocksuite/affine/blocks/surface/src/tool/default-tool.ts</code> - Reference implementation</li>
<li><code>blocksuite/framework/std/src/gfx/tool/tool-controller.ts</code> - Tool controller</li>
<li><code>blocksuite/affine/gfx/mindmap/src/view/view.ts</code> - Mind map view implementation</li>
</ul>
<h2 id="Reference-Documentation"><a href="#Reference-Documentation" class="headerlink" title="Reference Documentation"></a>Reference Documentation</h2><ul>
<li><a href="./tool-switching-mechanism.md">Tool Switching Mechanism In-depth Analysis</a></li>
<li><a href="./hand-mode-hover-fix.md">Hand Mode Hover Functionality Issue Analysis and Solution</a></li>
<li><a href="./event-routing-interactivity.md">Event Routing and Interactivity System Detailed Explanation</a></li>
<li><a href="./mindmap-collapse-button.md">Mind Map Collapse Button Implementation</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://xsun.work">Alex Sun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://xsun.work/posts/aca9ee12/">http://xsun.work/posts/aca9ee12/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/AI-generated/">AI generated</a><a class="post-meta__tags" href="/tags/AI-summary/">AI summary</a><a class="post-meta__tags" href="/tags/Learnify/">Learnify</a><a class="post-meta__tags" href="/tags/Claude-Code/">Claude Code</a><a class="post-meta__tags" href="/tags/Claude-4-Opus/">Claude-4-Opus</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>Sponsor</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/87b19c5e/" title="Learnify - Tool Selector Modes - Select/Hand Toggle"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Learnify - Tool Selector Modes - Select/Hand Toggle</div></div><div class="info-2"><div class="info-item-1">Learnify - Tool Selector Modes - Select&#x2F;Hand ToggleOverviewThe tool selector allows switching between Select mode (default) and Hand mode (pan) for navigating the canvas. Key File Location: /blocksuite/affine/gfx/pointer/src/quick-tool/default-tool-button.ts Main Function: _changeTool() (lines 24-48)  Mode Types Select Mode (Default Tool)  Icon: SelectIcon() Used for selecting and editing elements Keyboard shortcut: V   Hand Mode (Pan Tool)  Icon: HandIcon() Used for panning&#x2F;draggin...</div></div></div></a><a class="pagination-related" href="/posts/e8b2138a/" title="Learnify - Mind Map Node Collapse/Expand Button"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Learnify - Mind Map Node Collapse/Expand Button</div></div><div class="info-2"><div class="info-item-1">Learnify - Mind Map Node Collapse&#x2F;Expand ButtonOverviewA circular button appears on hover over mind map nodes that have children, allowing users to collapse&#x2F;expand node branches. Key FilesMain Logic Location: /blocksuite/affine/gfx/mindmap/src/view/view.ts Class: MindMapView  Key Methods _initCollapseButtons() - Initializes collapse buttons for all nodes _updateCollapseButton() - Creates&#x2F;updates individual collapse buttons _updateButtonVisibility() (lines 431-461) - Controls bu...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/ca55133e/" title="Learnify - Tool Switching Mechanism"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-09</div><div class="info-item-2">Learnify - Tool Switching Mechanism</div></div><div class="info-2"><div class="info-item-1">Learnify - In-depth Analysis of Tool Switching MechanismOverviewThis document provides a detailed analysis of the core mechanism for tool switching in BlockSuite, with a particular focus on the full process of switching from DefaultTool to PanTool. Core Components1. ToolController (blocksuite/framework/std/src/gfx/tool/tool-controller.ts)ToolController is the core class responsible for managing tools, including registration, switching, and event routing. Key MethodsetTool&lt;T extends BaseToo...</div></div></div></a><a class="pagination-related" href="/posts/c129cbd5/" title="Learnify - Edgeless Theme Behavior Analysis"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-09</div><div class="info-item-2">Learnify - Edgeless Theme Behavior Analysis</div></div><div class="info-2"><div class="info-item-1">Learnify - Edgeless Theme Behavior AnalysisProblem DescriptionEdgeless background color behaves inconsistently between edit mode and preview mode:  Edit Mode: When users create an edgeless in light mode and switch to dark mode, the background remains white Preview Mode: Shared read-only preview correctly follows the current theme color  Root Cause1. Different Theme Extension ImplementationsEdit Mode - AffineThemeExtension (/packages/frontend/core/src/blocksuite/view-extensions/theme/theme.ts)...</div></div></div></a><a class="pagination-related" href="/posts/d927d254/" title="Learnify - Event Routing and Interactivity System Analysis"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-09</div><div class="info-item-2">Learnify - Event Routing and Interactivity System Analysis</div></div><div class="info-2"><div class="info-item-1">Learnify - Event Routing and Interactivity System AnalysisOverviewThis document provides an in-depth analysis of the event routing mechanism and Interactivity system in BlockSuite, explaining how they work together to handle complex user interactions, particularly hover and click functionalities in mind maps. Event Routing ArchitectureOverall Flow12345678910graph TD    A[User Operation] --&gt; B[Browser Native Event]    B --&gt; C[GfxViewEventManager]    C --&gt; D[ToolController.invokeToolHa...</div></div></div></a><a class="pagination-related" href="/posts/e8b2138a/" title="Learnify - Mind Map Node Collapse&#x2F;Expand Button"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-09</div><div class="info-item-2">Learnify - Mind Map Node Collapse&#x2F;Expand Button</div></div><div class="info-2"><div class="info-item-1">Learnify - Mind Map Node Collapse&#x2F;Expand ButtonOverviewA circular button appears on hover over mind map nodes that have children, allowing users to collapse&#x2F;expand node branches. Key FilesMain Logic Location: /blocksuite/affine/gfx/mindmap/src/view/view.ts Class: MindMapView  Key Methods _initCollapseButtons() - Initializes collapse buttons for all nodes _updateCollapseButton() - Creates&#x2F;updates individual collapse buttons _updateButtonVisibility() (lines 431-461) - Controls bu...</div></div></div></a><a class="pagination-related" href="/posts/b43d01ac/" title="Learnify - Hand Mode Hover Functionality Issue Analysis and Solution"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-09</div><div class="info-item-2">Learnify - Hand Mode Hover Functionality Issue Analysis and Solution</div></div><div class="info-2"><div class="info-item-1">Learnify - Hand Mode Hover Functionality Issue Analysis and SolutionProblem DescriptionWhen users switch from the default Select tool to Hand Mode (pan tool), the following issues occur:  Complete hover functionality failure: No visual feedback when hovering over mind map nodes Collapse buttons invisible: Expand&#x2F;collapse buttons for mind map nodes cannot be displayed Cursor doesn&#39;t change: Cursor doesn&#39;t change to pointer when hovering over interactive elements Click operations f...</div></div></div></a><a class="pagination-related" href="/posts/87b19c5e/" title="Learnify - Tool Selector Modes - Select&#x2F;Hand Toggle"><img class="cover" src="https://cdn.jsdelivr.net/gh/a1exsun/file@main/hexo/claude-code.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-09</div><div class="info-item-2">Learnify - Tool Selector Modes - Select&#x2F;Hand Toggle</div></div><div class="info-2"><div class="info-item-1">Learnify - Tool Selector Modes - Select&#x2F;Hand ToggleOverviewThe tool selector allows switching between Select mode (default) and Hand mode (pan) for navigating the canvas. Key File Location: /blocksuite/affine/gfx/pointer/src/quick-tool/default-tool-button.ts Main Function: _changeTool() (lines 24-48)  Mode Types Select Mode (Default Tool)  Icon: SelectIcon() Used for selecting and editing elements Keyboard shortcut: V   Hand Mode (Pan Tool)  Icon: HandIcon() Used for panning&#x2F;draggin...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Learnify-PanTool-Enhancement-Implementation-Guide"><span class="toc-text">Learnify - PanTool Enhancement Implementation Guide</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Original-PanTool-Analysis"><span class="toc-text">Original PanTool Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Functional-Limitations"><span class="toc-text">Functional Limitations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Problem-Analysis"><span class="toc-text">Problem Analysis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enhancement-Design-Goals"><span class="toc-text">Enhancement Design Goals</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Functional-Goals"><span class="toc-text">Functional Goals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Design-Principles"><span class="toc-text">Design Principles</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementation-Steps"><span class="toc-text">Implementation Steps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Import-Dependencies"><span class="toc-text">1. Import Dependencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Add-Interactivity-System-Support"><span class="toc-text">2. Add Interactivity System Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Enhanced-Drag-Event-Handling"><span class="toc-text">3. Enhanced Drag Event Handling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Original-Implementation"><span class="toc-text">Original Implementation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enhanced-Implementation"><span class="toc-text">Enhanced Implementation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Add-Complete-Interaction-Methods"><span class="toc-text">4. Add Complete Interaction Methods</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#click-Click-Interaction"><span class="toc-text">click - Click Interaction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pointerMove-Hover-Functionality"><span class="toc-text">pointerMove - Hover Functionality</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pointerDown-pointerUp-Complete-Mouse-Lifecycle"><span class="toc-text">pointerDown&#x2F;pointerUp - Complete Mouse Lifecycle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#doubleClick-Double-Click-Operations"><span class="toc-text">doubleClick - Double-Click Operations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Signal-System-Update"><span class="toc-text">5. Signal System Update</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Original-Implementation-1"><span class="toc-text">Original Implementation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Updated-Implementation"><span class="toc-text">Updated Implementation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-It-Works"><span class="toc-text">How It Works</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Handling-Flow"><span class="toc-text">Event Handling Flow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Maintaining-Panning-Functionality"><span class="toc-text">Maintaining Panning Functionality</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enhanced-Interaction-Functionality"><span class="toc-text">Enhanced Interaction Functionality</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Testing-and-Validation"><span class="toc-text">Testing and Validation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Functional-Testing"><span class="toc-text">Functional Testing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Panning-Functionality-Test"><span class="toc-text">1. Panning Functionality Test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Interaction-Functionality-Test"><span class="toc-text">2. Interaction Functionality Test</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Performance-Testing"><span class="toc-text">Performance Testing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Event-Handling-Overhead"><span class="toc-text">1. Event Handling Overhead</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Memory-Usage"><span class="toc-text">2. Memory Usage</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compatibility-Considerations"><span class="toc-text">Compatibility Considerations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Backward-Compatibility"><span class="toc-text">Backward Compatibility</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Middle-Click-Panning-Functionality"><span class="toc-text">Middle-Click Panning Functionality</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debugging-and-Monitoring"><span class="toc-text">Debugging and Monitoring</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Tracking"><span class="toc-text">Event Tracking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Performance-Monitoring"><span class="toc-text">Performance Monitoring</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Known-Issues-and-Solutions"><span class="toc-text">Known Issues and Solutions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Linter-Errors"><span class="toc-text">1. Linter Errors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Import-Order"><span class="toc-text">2. Import Order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Signal-API-Update"><span class="toc-text">3. Signal API Update</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Best-Practices-Summary"><span class="toc-text">Best Practices Summary</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tool-Design-Principles"><span class="toc-text">Tool Design Principles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-Organization"><span class="toc-text">Code Organization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Testing-Strategy"><span class="toc-text">Testing Strategy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#File-Comparison"><span class="toc-text">File Comparison</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Before-vs-After-Modifications"><span class="toc-text">Before vs After Modifications</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Related-Files"><span class="toc-text">Related Files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference-Documentation"><span class="toc-text">Reference Documentation</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2023 - 2025 By Alex Sun</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>